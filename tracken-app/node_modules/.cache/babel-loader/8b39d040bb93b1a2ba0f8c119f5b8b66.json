{"ast":null,"code":"import _objectSpread from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _defineProperty from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/vlad/Desktop/repos/jfdd11-nan-app/src/components/Chat/Apps.js\";\nimport React, { Component } from \"react\";\nimport \"./Apps.css\";\nimport Form from \"../Chat/Form.js\";\nimport { Dropdown, Menu } from 'semantic-ui-react';\nimport firebase from \"firebase\";\nimport MainMenu from \"../MainMenu\";\n\nvar Apps =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Apps, _Component);\n\n  function Apps() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Apps);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Apps)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      user: null,\n      adminIds: null,\n      users: null,\n      currentChatId: null\n    };\n\n    _this.readAdmins = function (snapshot) {\n      _this.setState({\n        adminIds: Object.keys(snapshot.val() || {})\n      });\n    };\n\n    _this.readUsers = function (snapshot) {\n      _this.setState({\n        users: snapshot.val()\n      });\n    };\n\n    _this.startChat = function (chatBuddyId) {\n      var _updates;\n\n      var myId = _this.state.user && _this.state.user.uid;\n\n      if (myId === null || chatBuddyId === null) {\n        return;\n      }\n\n      var chatId = firebase.database().ref(\"chats\").push().key;\n      var updates = (_updates = {}, _defineProperty(_updates, \"/chats/\".concat(chatId), {\n        firstUserId: myId,\n        secondUserId: chatBuddyId\n      }), _defineProperty(_updates, \"/users/\".concat(myId, \"/chatIds/\").concat(chatId), true), _defineProperty(_updates, \"/users/\".concat(chatBuddyId, \"/chatIds/\").concat(chatId), true), _updates);\n      firebase.database().ref().update(updates);\n\n      _this.setState({\n        currentChatId: chatId\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Apps, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      firebase.auth().onAuthStateChanged(function (user) {\n        _this2.setState({\n          user: user\n        });\n      });\n      firebase.database().ref(\"admins\").on(\"value\", this.readAdmins);\n      firebase.database().ref(\"users\").on(\"value\", this.readUsers);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      firebase.database().ref(\"admins\").off(\"value\", this.readAdmins);\n      firebase.database().ref(\"users\").off(\"value\", this.readusers);\n    }\n  }, {\n    key: \"handleSignIn\",\n    value: function handleSignIn() {\n      var _this3 = this;\n\n      firebase.auth().signInWithEmailAndPassword().then(function (data) {\n        _this3.setState({\n          error: null,\n          success: \"Sign in successful\"\n        });\n      }).catch(function (error) {\n        return _this3.setState({\n          error: error,\n          success: null\n        });\n      });\n    }\n  }, {\n    key: \"handleLogOut\",\n    value: function handleLogOut() {\n      firebase.auth().signOut();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var users = this.state.adminIds && this.state.adminIds.map(function (userId) {\n        return _this4.state.users && _this4.state.users[userId] && _objectSpread({\n          id: userId\n        }, _this4.state.users[userId]);\n      }).filter(function (user) {\n        return user === undefined || user === null ? false : true;\n      });\n      return React.createElement(\"div\", {\n        className: \"app\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"mainMenuChat\",\n        style: {\n          width: \"100%\",\n          background: \"#eee\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }, React.createElement(MainMenu, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }, \"Welocome to Tracken Chat\"), React.createElement(\"ul\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119\n        },\n        __self: this\n      }, users && users.map(function (user) {\n        return React.createElement(\"li\", {\n          key: user.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          onClick: function onClick() {\n            return _this4.startChat(user.id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124\n          },\n          __self: this\n        }, \"Start Chat with Admin \"));\n      })), this.state.currentChatId, React.createElement(Menu, {\n        vertical: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, React.createElement(Dropdown, {\n        item: true,\n        text: \"Chats\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, React.createElement(Dropdown.Menu, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, this.state.user && this.state.users && Object.keys(this.state.users[this.state.user.uid].chatIds || {}).map(function (id) {\n        return React.createElement(Dropdown.Item, {\n          key: id,\n          onClick: function onClick() {\n            return _this4.setState({\n              currentChatId: id\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 135\n          },\n          __self: this\n        }, id);\n      }))))), React.createElement(\"div\", {\n        className: \"app__list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, this.state.currentChatId && React.createElement(Form, {\n        user: this.state.user,\n        users: this.state.users,\n        key: this.state.currentChatId,\n        chatId: this.state.currentChatId,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Apps;\n}(Component);\n\nexport default Apps;","map":{"version":3,"sources":["/home/vlad/Desktop/repos/jfdd11-nan-app/src/components/Chat/Apps.js"],"names":["React","Component","Form","Dropdown","Menu","firebase","MainMenu","Apps","state","user","adminIds","users","currentChatId","readAdmins","snapshot","setState","Object","keys","val","readUsers","startChat","chatBuddyId","myId","uid","chatId","database","ref","push","key","updates","firstUserId","secondUserId","update","auth","onAuthStateChanged","on","off","readusers","signInWithEmailAndPassword","then","data","error","success","catch","signOut","map","userId","id","filter","undefined","width","background","chatIds"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./Apps.css\";\nimport Form from \"../Chat/Form.js\";\nimport { Dropdown, Menu } from 'semantic-ui-react'\nimport firebase from \"firebase\";\nimport MainMenu from \"../MainMenu\";\n\nclass Apps extends Component {\n  state = {\n    user: null,\n    adminIds: null,\n    users: null,\n    currentChatId: null\n  };\n\n  readAdmins = snapshot => {\n    this.setState({\n      adminIds: Object.keys(snapshot.val() || {})\n    });\n  };\n\n  readUsers = snapshot => {\n    this.setState({\n      users: snapshot.val()\n    });\n  };\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(user => {\n      this.setState({ user });\n    });\n    firebase\n      .database()\n      .ref(\"admins\")\n      .on(\"value\", this.readAdmins);\n    firebase\n      .database()\n      .ref(\"users\")\n      .on(\"value\", this.readUsers);\n  }\n\n  componentWillUnmount() {\n    firebase\n      .database()\n      .ref(\"admins\")\n      .off(\"value\", this.readAdmins);\n    firebase\n      .database()\n      .ref(\"users\")\n      .off(\"value\", this.readusers);\n  }\n\n  startChat = chatBuddyId => {\n    const myId = this.state.user && this.state.user.uid;\n\n    if (myId === null || chatBuddyId === null) {\n      return;\n    }\n\n    const chatId = firebase\n      .database()\n      .ref(\"chats\")\n      .push().key;\n\n    const updates = {\n      [`/chats/${chatId}`]: {\n        firstUserId: myId,\n        secondUserId: chatBuddyId\n      },\n      [`/users/${myId}/chatIds/${chatId}`]: true,\n      [`/users/${chatBuddyId}/chatIds/${chatId}`]: true,\n    }\n\n    firebase\n      .database()\n      .ref().update(updates)\n\n    this.setState({\n      currentChatId: chatId\n    });\n  };\n\n  handleSignIn() {\n    firebase\n      .auth()\n      .signInWithEmailAndPassword()\n      .then(data => {\n        this.setState({ error: null, success: \"Sign in successful\" });\n      })\n      .catch(error => this.setState({ error: error, success: null }));\n  }\n  handleLogOut() {\n    firebase.auth().signOut();\n  }\n  render() {\n    const users =\n      this.state.adminIds &&\n      this.state.adminIds\n        .map(\n          userId =>\n            this.state.users &&\n            this.state.users[userId] && {\n              id: userId,\n              ...this.state.users[userId]\n            }\n        )\n        .filter(user => (user === undefined || user === null ? false : true));\n\n    return (\n      <div className=\"app\">\n        <div\n          className=\"mainMenuChat\"\n          style={{ width: \"100%\", background: \"#eee\" }}\n        >\n          <MainMenu />\n        </div>\n        <div>\n          <h1>Welocome to Tracken Chat</h1>\n          <ul>\n            {users &&\n              users.map(user => (\n                <li key={user.id}>\n                  \n                  <button onClick={() => this.startChat(user.id)}>Start Chat with Admin </button>\n                </li>\n              ))}\n          </ul>\n          {this.state.currentChatId}\n          <Menu vertical>\n            <Dropdown item text='Chats'>\n              <Dropdown.Menu>\n          {this.state.user && this.state.users && Object.keys(this.state.users[this.state.user.uid].chatIds || {}).map(\n            id => \n            \n                (<Dropdown.Item key={id} onClick={() => this.setState({ currentChatId: id })}>{id}</Dropdown.Item>)\n                )}\n              </Dropdown.Menu>\n            </Dropdown>\n          </Menu>\n          \n        </div>\n        <div className=\"app__list\">\n          {this.state.currentChatId && (\n            <Form user={this.state.user} users={this.state.users} key={this.state.currentChatId} chatId={this.state.currentChatId} />\n          )}\n        </div>\n      </div>\n    );\n  }\n}\nexport default Apps;\n"]},"metadata":{},"sourceType":"module"}