{"ast":null,"code":"import _defineProperty from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/vlad/Desktop/repos/jfdd11-nan-app/src/components/Chat/Apps.js\";\nimport React, { Component } from \"react\";\nimport \"./Apps.css\";\nimport Form from \"../Chat/Form.js\";\nimport { Dropdown, Menu } from 'semantic-ui-react';\nimport firebase from \"firebase\";\nimport MainMenu from \"../MainMenu\";\n\nvar Apps =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Apps, _Component);\n\n  function Apps() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Apps);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Apps)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      user: null,\n      adminIds: null,\n      users: null,\n      currentChatId: null\n    };\n\n    _this.readAdmins = function (snapshot) {\n      _this.setState({\n        adminIds: Object.keys(snapshot.val() || {})\n      });\n    };\n\n    _this.readUsers = function (snapshot) {\n      _this.setState({\n        users: snapshot.val()\n      });\n    };\n\n    _this.readChats = function (snapshot) {\n      _this.setState({\n        chats: snapshot.val()\n      });\n    };\n\n    _this.getChats = function () {\n      var _this$state = _this.state,\n          chats = _this$state.chats,\n          users = _this$state.users,\n          user = _this$state.user;\n\n      if (!chats || !users || !user) {\n        return [];\n      }\n\n      var chatIdsAsObject = _this.state.users[_this.state.user.uid].chatIds;\n      var chatIdsAsArray = Object.keys(chatIdsAsObject);\n      var presentedChats = chatIdsAsArray.map(function (chatId) {\n        if (chatId) {\n          return _objectSpread({}, chats[chatId], {\n            id: chatId\n          });\n        } else {\n          return null;\n        }\n      }).filter(function (chat) {\n        return chat !== null;\n      }).filter(function (chat) {\n        var firstUserId = chat.firstUserId,\n            secondUserId = chat.secondUserId;\n        var loggedInUserId = user.uid;\n        return firstUserId !== loggedInUserId || secondUserId !== loggedInUserId;\n      }).map(function (chat) {\n        var firstUserId = chat.firstUserId,\n            secondUserId = chat.secondUserId;\n        var loggedInUserId = user.id;\n        return {\n          chatId: chat.id,\n          userName: loggedInUserId === firstUserId ? users[secondUserId].name : users[firstUserId].name\n        };\n      });\n      return presentedChats;\n    };\n\n    _this.startChat = function (chatBuddyId) {\n      var _updates;\n\n      var myId = _this.state.user && _this.state.user.uid;\n\n      if (myId === null || chatBuddyId === null) {\n        return;\n      }\n\n      var chatId = firebase.database().ref(\"chats\").push().key;\n      var updates = (_updates = {}, _defineProperty(_updates, \"/chats/\".concat(chatId), {\n        firstUserId: myId,\n        secondUserId: chatBuddyId\n      }), _defineProperty(_updates, \"/users/\".concat(myId, \"/chatIds/\").concat(chatId), true), _defineProperty(_updates, \"/users/\".concat(chatBuddyId, \"/chatIds/\").concat(chatId), true), _updates);\n      firebase.database().ref().update(updates);\n\n      _this.setState({\n        currentChatId: chatId\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Apps, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      firebase.auth().onAuthStateChanged(function (user) {\n        _this2.setState({\n          user: user\n        });\n      });\n      firebase.database().ref(\"admins\").on(\"value\", this.readAdmins);\n      firebase.database().ref(\"users\").on(\"value\", this.readUsers);\n      firebase.database().ref(\"chats\").on(\"value\", this.readChats);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      firebase.database().ref(\"admins\").off(\"value\", this.readAdmins);\n      firebase.database().ref(\"users\").off(\"value\", this.readusers);\n      firebase.database().ref(\"users\").off(\"value\", this.readChats);\n    }\n  }, {\n    key: \"handleSignIn\",\n    value: function handleSignIn() {\n      var _this3 = this;\n\n      firebase.auth().signInWithEmailAndPassword().then(function (data) {\n        _this3.setState({\n          error: null,\n          success: \"Sign in successful\"\n        });\n      }).catch(function (error) {\n        return _this3.setState({\n          error: error,\n          success: null\n        });\n      });\n    }\n  }, {\n    key: \"handleLogOut\",\n    value: function handleLogOut() {\n      firebase.auth().signOut();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var users = this.state.adminIds && this.state.adminIds.map(function (userId) {\n        return _this4.state.users && _this4.state.users[userId] && _objectSpread({\n          id: userId\n        }, _this4.state.users[userId]);\n      }).filter(function (user) {\n        return user === undefined || user === null ? false : true;\n      });\n      return React.createElement(\"div\", {\n        className: \"app\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"mainMenuChat\",\n        style: {\n          width: \"100%\",\n          background: \"#eee\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, React.createElement(MainMenu, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, \"Welcome to Tracken Chat\"), React.createElement(\"ul\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, users && users.map(function (user) {\n        return React.createElement(\"li\", {\n          key: user.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          onClick: function onClick() {\n            return _this4.startChat(user.id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, \"Start Chat with Admin \"));\n      }))), React.createElement(\"div\", {\n        className: \"app__list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(Menu, {\n        vertical: true,\n        style: {\n          width: \"auto\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(Dropdown, {\n        item: true,\n        text: this.state.currentChatUserName,\n        style: {\n          textAlign: \"center\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, React.createElement(Dropdown.Menu, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, this.state.user && this.state.users && this.getChats().map(function (chat) {\n        return React.createElement(Dropdown.Item, {\n          key: chat.chatId,\n          onClick: function onClick() {\n            return _this4.setState({\n              currentChatId: chat.chatId,\n              currentChatUserName: chat.userName\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }, chat.userName);\n      })))), this.state.currentChatId && React.createElement(Form, {\n        user: this.state.user,\n        users: this.state.users,\n        key: this.state.currentChatId,\n        chatId: this.state.currentChatId,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Apps;\n}(Component);\n\nexport default Apps;","map":{"version":3,"sources":["/home/vlad/Desktop/repos/jfdd11-nan-app/src/components/Chat/Apps.js"],"names":["React","Component","Form","Dropdown","Menu","firebase","MainMenu","Apps","state","user","adminIds","users","currentChatId","readAdmins","snapshot","setState","Object","keys","val","readUsers","readChats","chats","getChats","chatIdsAsObject","uid","chatIds","chatIdsAsArray","presentedChats","map","chatId","id","filter","chat","firstUserId","secondUserId","loggedInUserId","userName","name","startChat","chatBuddyId","myId","database","ref","push","key","updates","update","auth","onAuthStateChanged","on","off","readusers","signInWithEmailAndPassword","then","data","error","success","catch","signOut","userId","undefined","width","background","currentChatUserName","textAlign"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./Apps.css\";\nimport Form from \"../Chat/Form.js\";\nimport { Dropdown, Menu } from 'semantic-ui-react'\nimport firebase from \"firebase\";\nimport MainMenu from \"../MainMenu\";\n\nclass Apps extends Component {\n  state = {\n    user: null,\n    adminIds: null,\n    users: null,\n    currentChatId: null\n  };\n\n  readAdmins = snapshot => {\n    this.setState({\n      adminIds: Object.keys(snapshot.val() || {})\n    });\n  };\n\n  readUsers = snapshot => {\n    this.setState({\n      users: snapshot.val()\n    });\n  };\n\n  readChats = snapshot => {\n    this.setState({\n      chats: snapshot.val()\n    })\n  }\n\n  getChats = () => {\n    const { chats, users, user } = this.state\n    if (!chats || !users || !user) {\n      return []\n    }\n\n    const chatIdsAsObject = this.state.users[this.state.user.uid].chatIds\n    const chatIdsAsArray = Object.keys(chatIdsAsObject)\n\n    const presentedChats = chatIdsAsArray\n      .map(chatId => {\n        if (chatId) {\n          return {\n            ...chats[chatId],\n            id: chatId\n          }\n        } else {\n          return null\n        }\n      })\n      .filter(chat => chat !== null)\n      .filter(chat => {\n        const { firstUserId, secondUserId } = chat\n        const loggedInUserId = user.uid\n        \n        return firstUserId !== loggedInUserId || secondUserId !== loggedInUserId \n      })\n      .map(chat => {\n        const { firstUserId, secondUserId } = chat\n        const loggedInUserId = user.id\n        return {\n          chatId: chat.id,\n          userName: loggedInUserId === firstUserId ? users[secondUserId].name : users[firstUserId].name \n        }\n      })\n\n    return presentedChats\n  }\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(user => {\n      this.setState({ user });\n    });\n    firebase\n      .database()\n      .ref(\"admins\")\n      .on(\"value\", this.readAdmins);\n    firebase\n      .database()\n      .ref(\"users\")\n      .on(\"value\", this.readUsers);\n    firebase\n      .database()\n      .ref(\"chats\")\n      .on(\"value\", this.readChats)\n  }\n\n  componentWillUnmount() {\n    firebase\n      .database()\n      .ref(\"admins\")\n      .off(\"value\", this.readAdmins);\n    firebase\n      .database()\n      .ref(\"users\")\n      .off(\"value\", this.readusers);\n    firebase\n      .database()\n      .ref(\"users\")\n      .off(\"value\", this.readChats);\n  }\n\n  startChat = chatBuddyId => {\n    const myId = this.state.user && this.state.user.uid;\n\n    if (myId === null || chatBuddyId === null) {\n      return;\n    }\n\n    const chatId = firebase\n      .database()\n      .ref(\"chats\")\n      .push().key;\n\n    const updates = {\n      [`/chats/${chatId}`]: {\n        firstUserId: myId,\n        secondUserId: chatBuddyId\n      },\n      [`/users/${myId}/chatIds/${chatId}`]: true,\n      [`/users/${chatBuddyId}/chatIds/${chatId}`]: true,\n    }\n\n    firebase\n      .database()\n      .ref().update(updates)\n\n    this.setState({\n      currentChatId: chatId\n    });\n  };\n\n  handleSignIn() {\n    firebase\n      .auth()\n      .signInWithEmailAndPassword()\n      .then(data => {\n        this.setState({ error: null, success: \"Sign in successful\" });\n      })\n      .catch(error => this.setState({ error: error, success: null }));\n  }\n  handleLogOut() {\n    firebase.auth().signOut();\n  }\n  render() {\n    const users =\n      this.state.adminIds &&\n      this.state.adminIds\n        .map(\n          userId =>\n            this.state.users &&\n            this.state.users[userId] && {\n              id: userId,\n              ...this.state.users[userId]\n            }\n        )\n        .filter(user => (user === undefined || user === null ? false : true));\n\n    return (\n      <div className=\"app\">\n        <div\n          className=\"mainMenuChat\"\n          style={{ width: \"100%\", background: \"#eee\" }}\n        >\n          <MainMenu />\n        </div>\n        <div>\n          <h1>Welcome to Tracken Chat</h1>\n          <ul>\n            {users &&\n              users.map(user => (\n                <li key={user.id}>\n                  \n                  <button onClick={() => this.startChat(user.id)}>Start Chat with Admin </button>\n                </li>\n              ))}\n          </ul>\n          \n       \n          \n        </div>\n        <div className=\"app__list\">\n        <Menu vertical style={{\n          width: \"auto\"\n        }}>\n            <Dropdown item text={(this.state.currentChatUserName)} style={{\n              textAlign: \"center\"\n            }}>\n              <Dropdown.Menu>\n          {this.state.user && this.state.users && this.getChats().map(\n            chat => {\n              return (<Dropdown.Item key={chat.chatId} onClick={() => this.setState({\n                currentChatId: chat.chatId,\n                currentChatUserName: chat.userName\n              })}>{chat.userName}</Dropdown.Item>)\n            })}\n              </Dropdown.Menu>\n            </Dropdown>\n          </Menu>\n          {this.state.currentChatId && (\n            <Form user={this.state.user} users={this.state.users} key={this.state.currentChatId} chatId={this.state.currentChatId} />\n          )}\n        </div>\n      </div>\n    );\n  }\n}\nexport default Apps;\n"]},"metadata":{},"sourceType":"module"}