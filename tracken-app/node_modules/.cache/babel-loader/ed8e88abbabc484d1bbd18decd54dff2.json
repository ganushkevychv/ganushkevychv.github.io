{"ast":null,"code":"import _objectSpread from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/vlad/Desktop/repos/jfdd11-nan-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/vlad/Desktop/repos/jfdd11-nan-app/src/contexts/AuthContext.js\";\nimport React, { Component } from \"react\";\nimport firebase from \"firebase\"; // The argument passed to `createContext` is being used only\n// if given context provider is not available within VDOM\n// tree above the Consumer.\n\nexport var AuthContext = React.createContext({\n  user: null\n});\nvar Provider = AuthContext.Provider,\n    Consumer = AuthContext.Consumer;\n\nvar AuthContextProvider =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AuthContextProvider, _Component);\n\n  function AuthContextProvider() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AuthContextProvider);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AuthContextProvider)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      user: null,\n      userData: {\n        company_name: \"\",\n        name: \"\",\n        surname: \"\",\n        nip: \"\",\n        phone: \"\",\n        city: \"\",\n        postalcode: \"\",\n        street: \"\",\n        number: \"\",\n        contactsBook: []\n      },\n      signOut: function signOut() {\n        return firebase.auth().signOut();\n      },\n      signIn: function signIn(email, password) {\n        return firebase.auth().signInWithEmailAndPassword(email, password);\n      }\n    };\n    _this.userDbRef = null;\n\n    _this.readUserData = function (snapshot) {\n      var person = snapshot.val();\n\n      if (person === null) {\n        return;\n      }\n\n      _this.setState({\n        userData: {\n          name: person.name,\n          surname: person.surname,\n          company_name: person.company_name,\n          nip: person.nip,\n          phone: person.phone,\n          city: person.city,\n          postalcode: person.postalcode,\n          street: person.street,\n          number: person.number,\n          contactsBook: Object.entries(person.contactsBook || {}).map(function (_ref) {\n            var _ref2 = _slicedToArray(_ref, 2),\n                id = _ref2[0],\n                value = _ref2[1];\n\n            return _objectSpread({\n              id: id\n            }, value);\n          })\n        }\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(AuthContextProvider, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.unsubscribe = firebase.auth().onAuthStateChanged(function (user) {\n        _this2.setState({\n          user: user\n        });\n\n        if (user !== null) {\n          _this2.userDbRef = firebase.database().ref(\"users/\".concat(user.uid));\n\n          _this2.userDbRef.on(\"value\", _this2.readUserData);\n        } else {\n          _this2.userDbRef && _this2.userDbRef.off(\"value\", _this2.readUserData);\n        }\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unsubscribe();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(Provider, {\n        value: this.state,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, this.props.children);\n    }\n  }]);\n\n  return AuthContextProvider;\n}(Component); // HOC - Higher Order Component\n\n\nexport { AuthContextProvider as default };\nexport var withAuth = function withAuth(Component) {\n  return function (props) {\n    return React.createElement(Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, function (value) {\n      return React.createElement(Component, Object.assign({}, props, {\n        authContext: value,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }));\n    });\n  };\n};","map":{"version":3,"sources":["/home/vlad/Desktop/repos/jfdd11-nan-app/src/contexts/AuthContext.js"],"names":["React","Component","firebase","AuthContext","createContext","user","Provider","Consumer","AuthContextProvider","state","userData","company_name","name","surname","nip","phone","city","postalcode","street","number","contactsBook","signOut","auth","signIn","email","password","signInWithEmailAndPassword","userDbRef","readUserData","snapshot","person","val","setState","Object","entries","map","id","value","unsubscribe","onAuthStateChanged","database","ref","uid","on","off","props","children","withAuth"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport firebase from \"firebase\";\n\n// The argument passed to `createContext` is being used only\n// if given context provider is not available within VDOM\n// tree above the Consumer.\nexport const AuthContext = React.createContext({ user: null });\nconst { Provider, Consumer } = AuthContext;\n\nexport default class AuthContextProvider extends Component {\n  state = {\n    user: null,\n    userData: {\n      company_name: \"\",\n      name: \"\",\n      surname: \"\",\n      nip: \"\",\n      phone: \"\",\n      city: \"\",\n      postalcode: \"\",\n      street: \"\",\n      number: \"\",\n      contactsBook:[]\n    },\n    signOut: () => firebase.auth().signOut(),\n    signIn: (email, password) =>\n      firebase.auth().signInWithEmailAndPassword(email, password)\n  };\n\n  userDbRef = null;\n\n  readUserData = snapshot => {\n    const person = snapshot.val();\n\n    if (person === null) {\n      return;\n    }\n\n    this.setState({\n      userData: {\n        name: person.name,\n        surname: person.surname,\n        company_name: person.company_name,\n        nip: person.nip,\n        phone: person.phone,\n        city: person.city,\n        postalcode: person.postalcode,\n        street: person.street,\n        number: person.number,\n        contactsBook: Object.entries(person.contactsBook|| {}).map(([id, value]) => ({\n          id,\n          ...value\n        }))\n      }\n    });\n  };\n\n  componentDidMount() {\n    this.unsubscribe = firebase.auth().onAuthStateChanged(user => {\n      this.setState({ user });\n      if (user !== null) {\n        this.userDbRef = firebase.database().ref(`users/${user.uid}`);\n\n        this.userDbRef.on(\"value\", this.readUserData);\n      } else {\n        this.userDbRef && this.userDbRef.off(\"value\", this.readUserData);\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe();\n  }\n\n  render() {\n    return <Provider value={this.state}>{this.props.children}</Provider>;\n  }\n}\n\n// HOC - Higher Order Component\nexport const withAuth = Component => props => (\n  <Consumer>{value => <Component {...props} authContext={value} />}</Consumer>\n);\n"]},"metadata":{},"sourceType":"module"}